package com.channelsoft.ccod.recordmanager.monitor.service.impl;

import com.channelsoft.ccod.recordmanager.backup.vo.StoredRecordFileVo;
import com.channelsoft.ccod.recordmanager.config.*;
import com.channelsoft.ccod.recordmanager.constant.BackupMethod;
import com.channelsoft.ccod.recordmanager.constant.CCODPlatformType;
import com.channelsoft.ccod.recordmanager.constant.RecordCheckResult;
import com.channelsoft.ccod.recordmanager.constant.RecordType;
import com.channelsoft.ccod.recordmanager.monitor.dao.*;
import com.channelsoft.ccod.recordmanager.monitor.po.*;
import com.channelsoft.ccod.recordmanager.monitor.service.IPlatformRecordService;
import com.channelsoft.ccod.recordmanager.monitor.vo.*;
import com.channelsoft.ccod.recordmanager.notify.service.INotifyService;
import com.channelsoft.ccod.recordmanager.utils.GrokParser;
import org.apache.commons.io.FileUtils;
import org.apache.commons.lang3.StringUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.util.DigestUtils;

import javax.annotation.PostConstruct;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.text.SimpleDateFormat;
import java.util.*;
import java.util.concurrent.Callable;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.FutureTask;
import java.util.function.Function;
import java.util.regex.Pattern;
import java.util.stream.Collectors;

/**
 * @ClassName: PlatformRecordBaseService
 * @Author: lanhb
 * @Description: 平台录音服务基类，实现了不同平台录音服务的一些通用方法
 * @Date: 2020/4/9 9:32
 * @Version: 1.0
 */
public abstract  class PlatformRecordBaseService implements IPlatformRecordService {

    private final static Logger logger = LoggerFactory.getLogger(PlatformRecordBaseService.class);

    @Autowired
    protected RecordStoreCfg recordStoreCfg;

    @Autowired
    EnterpriseCfg enterpriseCfg;

    @Autowired
    INotifyService notifyService;

    @Autowired
    IPlatformRecordBackupResultDao platformRecordBackupResultDao;

    @Autowired
    IPlatformRecordCheckResultDao platformRecordCheckResultDao;

    @Autowired
    IEntRecordCheckResultDao entRecordCheckResultDao;

    @Autowired
    ICheckFailRecordDetailDao checkFailRecordDetailDao;

    @Autowired
    IFailBackupRecordFileDao failBackupRecordFileDao;

    @Autowired
    IMissBackupRecordDetailDao missBackupRecordDetailDao;

    @Value("${env.windows}")
    private boolean isWin;

    @Value("${ccod.platformId}")
    protected String platformId;

    @Value("${ccod.platformName}")
    protected String platformName;

    @Value("${ccod.hasBak}")
    protected boolean hasBak;

    @Value("${jobs.backup.backupRootPath}")
    protected String backupRootPath;

    @Value("${jobs.backup.verify}")
    protected boolean verify;

    @Value("${jobs.backup.compareWithDB}")
    protected boolean compareWithDB;

    @Value("${ccod.platformType}")
    protected CCODPlatformType platformType;

    @Value("${debug}")
    protected boolean debug;

    protected int threadPoolSize = 4;

    protected String[] testIndexes = ("0000099999/Agent/20190814/TEL-01057040278_1445_20200304100034.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304100254.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304100659.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304100727.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304100900.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304101003.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304101034.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304101059.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304101141.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304101224.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304101258.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304101340.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304101400.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304101505.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304101540.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304101605.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304101627.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304101752.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304101925.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304101955.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304102113.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304102135.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304103009.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304103552.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304105221.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304105354.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304105646.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304105801.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304105826.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304105855.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304105954.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304110555.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304110703.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304110745.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304110830.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304111046.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304111425.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304111515.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304111635.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304111719.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304111811.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304111838.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304111916.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304111949.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304112106.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304112221.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304112326.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304112731.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304112855.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304113439.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304113549.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304113701.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304113813.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304130406.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304130441.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304130520.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304130621.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304130729.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304130801.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304130845.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304130946.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304131019.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304131032.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304131101.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304131114.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304131157.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304131234.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304131258.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304131404.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304131721.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304131803.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304132127.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304132140.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304132227.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304132847.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304132921.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304133001.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304133102.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304133151.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304133255.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304133430.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304133541.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304133619.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304133725.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304133834.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304133919.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304133946.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304134106.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304134131.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304134235.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304134307.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304134408.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304134442.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304134536.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304134705.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304134736.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304135042.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304135133.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304135215.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304135329.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304135433.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304135825.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304140549.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304140635.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304140722.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304141311.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304141401.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304141519.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304141637.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304141817.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304141938.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304142020.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304142104.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304142252.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304142618.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304142742.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304142827.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304142858.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304142927.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304143006.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304143054.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304143306.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304143600.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304143721.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304144155.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304144258.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304144339.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304145131.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304145417.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304145525.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304145731.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304145831.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304150341.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304150434.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304150513.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304150703.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304151144.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304151434.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304151551.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304152020.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304152120.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304152457.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304160035.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304160131.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304160215.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304160551.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304161328.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304161505.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304161707.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304162144.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304162446.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304162631.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304163234.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304163325.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304163414.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304163651.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304163839.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304163921.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304164515.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304164648.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304164830.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304165012.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304165129.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304165149.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304165432.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304165556.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304165813.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304170456.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304170521.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304170628.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304170654.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304170737.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304170843.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040278_1445_20200304171805.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304100734.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304101106.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304101908.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304101935.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304101956.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304102226.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304102242.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304102451.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304102519.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304102525.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304103050.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304103127.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304103835.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304104717.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304104811.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304104838.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304104918.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304105111.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304105402.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304105447.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304105503.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304105747.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304105824.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304105953.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304110740.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304110831.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304111052.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304111417.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304111432.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304111741.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304112128.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304112538.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304112717.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304130307.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304130325.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304130414.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304130433.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304130535.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304130554.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304130602.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304130946.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304131019.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304131036.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304132132.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304132202.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304132216.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304132242.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304132249.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304132421.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304132552.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304132632.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304132935.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304133021.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304133055.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304133451.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304133619.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304133710.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304133734.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304133757.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304133828.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304133910.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304133933.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304135537.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304135637.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304161130.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304161702.wav\n" +
            "0000099999/Agent/20190814/TEL-01057040288_1446_20200304161746.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304100941.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304101027.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304101103.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304101156.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304101327.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304101412.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304101536.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304101610.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304101728.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304101922.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304102014.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304102055.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304102118.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304102320.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304102608.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304102719.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304102845.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304102924.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304102954.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304103018.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304103101.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304130107.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304130140.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304130248.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304130350.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304130442.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304130603.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304130645.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304130734.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304165415.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304165429.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304165547.wav\n" +
            "0000099999/Agent/20190814/TEL-01061496827_1467_20200304165802.wav\n" +
            "0000099999/Agent/20190814/TEL-01088822337_8888_20200304100148.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304101427.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304101452.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304101521.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304101643.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304101718.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304101808.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304102628.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304102824.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304102934.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304103006.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304103141.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304103300.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304103347.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304103510.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304103532.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304103653.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304103722.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304103754.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304103928.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304104012.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304104134.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304104327.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304104409.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304104432.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304104521.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304104700.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304125344.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304125407.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304125439.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304125523.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304125554.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304125616.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304125748.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304125813.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304125839.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304125927.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304130102.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304130150.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304130235.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304130322.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304165246.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304165312.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304165337.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304165424.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304165503.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304165549.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304165725.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304165816.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304165906.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304165950.wav\n" +
            "0000099999/Agent/20190814/TEL-01089456813_1460_20200304170054.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304100607.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304100914.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304101024.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304101115.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304101350.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304101441.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304101525.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304101607.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304101653.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304101838.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304101922.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304102308.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304102358.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304102428.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304102508.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304102808.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304103232.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304103324.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304103603.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304103722.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304103755.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304103823.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304103900.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304104020.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304104113.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304104410.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304104438.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304104611.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304104751.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304104921.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304105059.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304105224.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304105323.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304105413.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304105506.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304105732.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304105845.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304105920.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304105944.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304110038.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304110116.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304110158.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304110226.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304110421.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304110507.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304110641.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304110712.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304110843.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304110931.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304111009.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304111055.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304111401.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304111512.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304112907.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304113050.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304113129.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304113249.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304113403.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304113452.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304113533.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304113749.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304113853.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304113941.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304114019.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304114052.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304114138.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304114431.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304114500.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304114543.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304114647.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304114733.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304114805.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304114828.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304114926.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304115020.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304115045.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304115150.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304115430.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304115457.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304115525.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304115637.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304115713.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304130151.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304130222.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304130326.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304130406.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304130516.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304130552.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304130718.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304130901.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304130941.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304131053.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304131133.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304131249.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304131321.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304131554.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304131620.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304131642.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304131709.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304131822.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304131847.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304131916.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304132127.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304132227.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304132330.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304132443.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304132516.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304132719.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304132748.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304133042.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304133350.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304133452.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304133519.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304133551.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304133632.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304133742.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304133817.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304133912.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304134018.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304134050.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304134115.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304134137.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304134337.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304134428.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304134453.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304134554.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304134703.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304134806.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304134831.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304134910.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304134938.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304135015.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304135124.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304135153.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304135223.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304135242.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304135306.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304135325.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304135343.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304135450.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304135517.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304135555.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304141226.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304141248.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304141404.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304142500.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304142620.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304142839.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304142912.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304143044.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304143131.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304143400.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304143523.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304143619.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304143644.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304143747.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304143819.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304143848.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304143912.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304143941.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304144038.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304144132.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304144310.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304144543.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304144621.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304153458.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304153528.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304153814.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304153901.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304154004.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304154036.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304154105.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304154141.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304154220.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304154255.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304154412.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304154450.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304154519.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304154543.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304154604.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304154706.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304154807.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304154843.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304154914.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304155020.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304155223.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304155256.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304155605.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304155632.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304160525.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304160550.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304160657.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304160746.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304160812.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304160842.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304161134.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304161231.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304161256.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304161355.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304161415.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304161617.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304161643.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304161703.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304161733.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304161925.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304161952.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304162105.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304162135.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304162208.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304162316.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304162352.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304162415.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304162435.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304162452.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304162517.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304162541.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304162614.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304162650.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304162726.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304163000.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304163020.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304163058.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304165347.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304165423.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304165510.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304165612.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304165642.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304165702.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304165718.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304165751.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304165810.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304165910.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304170012.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304170042.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304170246.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304170313.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304170359.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304170539.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304170646.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304170901.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304171030.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304171211.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304171240.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304171439.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304171500.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304171532.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304171611.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304171656.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304171835.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304171933.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304172018.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304172153.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304172340.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304172401.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304172445.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304172512.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304172656.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304172757.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304172906.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304173107.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304173147.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304173218.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304173256.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304173558.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304173703.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304173805.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304174008.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304174038.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304174138.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304174350.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304174616.wav\n" +
            "0000099999/Agent/20190814/TEL-051687338914_1500_20200304174654.wav\n").split("\n");

    @PostConstruct
    public void init() throws Exception
    {
        System.out.println("*********************");
    }

    @Override
    public PlatformRecordCheckResultSumVo check(Date beginTime, Date endTime) {
        SimpleDateFormat sf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        if(debug)
        {
            Calendar ca = Calendar.getInstance();
            ca.set(Calendar.YEAR, 2019);
            ca.set(Calendar.MONTH, 7);
            ca.set(Calendar.DATE, 14);
            ca.set(Calendar.SECOND, 0);
            ca.set(Calendar.MILLISECOND, 0);
            beginTime = ca.getTime();
            ca.add(Calendar.MINUTE, 20);
            endTime = ca.getTime();
        }
        logger.debug(String.format("begin to check platform record from %s to %s",
                sf.format(beginTime), sf.format(endTime)));
        PlatformRecordCheckResultSumVo sumVo;
        try
        {
            sumVo = checkPlatformRecord(beginTime, endTime);
        }
        catch (Exception ex)
        {
            logger.debug(String.format("check platform record from %s to %s exception",
                    sf.format(beginTime), sf.format(endTime)), ex);
            sumVo = PlatformRecordCheckResultSumVo.fail(this.platformId, this.platformName, ex.getMessage());
        }
        try
        {
            addNewPlatformCheckResult(sumVo);
        }
        catch (Exception ex)
        {
            logger.error(String.format("insert platform check result to db exception"), ex);
        }
        if(debug && sumVo.isResult())
        {
            this.generateTestDate(sumVo);
        }
        return sumVo;
    }

    @Override
    public PlatformRecordBackupResultSumVo backup(Date backupDate){
        Date startTime = new Date();
        PlatformRecordBackupResultSumVo resultVo;
        try
        {
            List<StoredRecordFileVo> fileList = scanRecordFile(backupDate, this.recordStoreCfg.getMaster().getStoreRoles());
            List<FailBackupRecordFilePo> failList = backupByCopyDirectory(fileList, this.backupRootPath, this.verify, backupDate);
            if(!this.compareWithDB)
            {
                resultVo = new PlatformRecordBackupResultSumVo(this.platformId, this.platformName, backupDate, startTime, fileList, failList);
            }
            else
            {
                List<RecordDetailVo> notBackList = checkMissBackupRecordDetail(fileList, backupDate);
                resultVo = new PlatformRecordBackupResultSumVo(this.platformId, this.platformName, backupDate, startTime, fileList, failList, notBackList);
            }
        }
        catch (Exception ex)
        {
            SimpleDateFormat sf = new SimpleDateFormat("yyyyMMdd");
            logger.error(String.format("backup %s platform record exception", sf.format(backupDate)), ex);
            resultVo = PlatformRecordBackupResultSumVo.fail(this.platformId, this.platformName, backupDate, ex);
        }
        try
        {
            this.addPlatformRecordBackupResult(resultVo);
        }
        catch (Exception ex)
        {
            logger.error(String.format("add platform backup result exception"), ex);
        }
        return resultVo;
    }

    @Override
    public List<PlatformRecordCheckResultPo> queryPlatformRecordCheckResult(Date beginTime, Date endTime) throws Exception {
        return this.platformRecordCheckResultDao.select(beginTime, endTime);
    }

    @Override
    public List<EntRecordCheckResultPo> queryEntRecordCheckResult(Date beginTime, Date endTime) throws Exception {
        return this.entRecordCheckResultDao.select(beginTime, endTime);
    }

    @Override
    public List<CheckFailRecordDetailPo> queryEntRecordCheckDetail(String enterpriseId, Date beginTime, Date endTime) throws Exception {
        return this.checkFailRecordDetailDao.select(enterpriseId, beginTime, endTime);
    }

    @Override
    public List<PlatformRecordBackupResultPo> queryPlatformRecordBackupResult(Date beginTime, Date endTime) throws Exception {
        return this.platformRecordBackupResultDao.select(beginTime, endTime);
    }

    @Override
    public List<MissBackupRecordDetailPo> queryPlatformBackupMissRecordDetail(Date beginTime, Date endTime) throws Exception {
        return this.missBackupRecordDetailDao.select(beginTime, endTime);
    }

    @Override
    public List<FailBackupRecordFilePo> queryPlatformFailBackupFile(Date beginTime, Date endTime) throws Exception {
        return this.failBackupRecordFileDao.select(beginTime, endTime);
    }

    /**
     * 扫描某个日期的所有录音文件
     * @param scanDate 被扫描的日期
     * @param storeRoles 录音存储规则
     * @return 扫描出的素有录音文件
     */
    protected List<StoredRecordFileVo> scanRecordFile(Date scanDate, List<RecordStoreRole> storeRoles) throws IOException
    {
        List<StoredRecordFileVo> fileList = new ArrayList<>();
        for(RecordStoreRole storeRole : storeRoles)
        {
            List<StoredRecordFileVo> scanList = scanMntDir(storeRole, scanDate);
            logger.debug(String.format("scan mntDir=%s with grokPattern=%s find %d record files",
                    storeRole.getMntDir(), storeRole.getGrokPattern(), scanList.size()));
            fileList.addAll(scanList);
        }
        return fileList;
    }

    protected List<RecordDetailVo> checkMissBackupRecordDetail(List<StoredRecordFileVo> backupList, Date backupDate)
    {
        List<RecordDetailVo> retList = new ArrayList<>();
        PlatformRecordCheckResultSumVo checkResultVo;
        Calendar ca = Calendar.getInstance();
        ca.setTime(backupDate);
        ca.set(Calendar.MILLISECOND, 0);
        ca.set(Calendar.SECOND, 0);
        ca.set(Calendar.MINUTE, 0);
        ca.set(Calendar.HOUR, 0);
        Date beginTime = ca.getTime();
        ca.add(Calendar.DATE, 1);
        Date endTime = ca.getTime();
        try
        {
            checkResultVo = check(beginTime, endTime);

        }
        catch (Exception ex)
        {
            SimpleDateFormat sf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
            logger.error(String.format("query record detail form %s to %s exception",
                    sf.format(beginTime), sf.format(endTime)), ex);
            checkResultVo = PlatformRecordCheckResultSumVo.fail(this.platformId, this.platformName, ex.getMessage());
            notifyService.notify(checkResultVo);
            return retList;
        }
        Map<String, List<StoredRecordFileVo>> entRecordFileMap = backupList.stream().collect(Collectors.groupingBy(StoredRecordFileVo::getEnterpriseId));
        for(EntRecordCheckResultSumVo entRecordCheckResultVo : checkResultVo.getEntRecordCheckResultList()) {
            if (!entRecordFileMap.containsKey(entRecordCheckResultVo.getEnterpriseId())) {
                logger.warn(String.format("%s %d record not been backup",
                        entRecordCheckResultVo.getEnterpriseId(), entRecordCheckResultVo.getSuccessList().size()));
                retList.addAll(entRecordCheckResultVo.getSuccessList());
                continue;
            }
            Map<String, StoredRecordFileVo> fileMap = entRecordFileMap.get(entRecordCheckResultVo.getEnterpriseId())
                    .stream().collect(Collectors.toMap(StoredRecordFileVo::getRecordIndex, Function.identity()));
            for (RecordDetailVo detailVo : entRecordCheckResultVo.getSuccessList()) {
                if (!fileMap.containsKey(detailVo.getRecordIndex())) {
                    logger.error(String.format("%s[%s] %s not been backup",
                            detailVo.getEnterpriseId(), detailVo.getSessionId(), detailVo.getRecordIndex()));
                    retList.add(detailVo);
                }
            }
        }
        return retList;
    }

    protected String searchRecordIndexAbsolutePath(RecordIndexSearch indexSearch)
    {
        logger.debug(String.format("search record save path for index=%s, master=%b", indexSearch.recordIndex, indexSearch.isMaster));
        RecordStoreRole storeRole = indexSearch.storeRole;
        String recordIndex = indexSearch.recordIndex;
        String path = null;
        if(storeRole != null)
        {
            path = storeRole.getExample().replace(storeRole.getRecordIndex(), recordIndex);
            if(GrokParser.match(storeRole.grokPattern, path) != null)
            {
                File file = new File(path);
                if(file.exists() && file.isFile())
                {
                    logger.debug(String.format("find %s for index=%s, master=%b", path, recordIndex, indexSearch.isMaster));
                    return path;
                }
                else
                {
                    logger.warn(String.format("%s is match for %s, but not exist", path, storeRole.getGrokPattern()));
                }
            }
            else
            {
                logger.debug(String.format("index=%s not match for %s", recordIndex, storeRole.getGrokPattern()));
            }
        }
        List<RecordStoreRole> roles = indexSearch.isMaster ? this.recordStoreCfg.getMaster().getStoreRoles() : this.recordStoreCfg.getBackup().getStoreRoles();
        Map<String, RecordStoreRole> roleMap = roles.stream().collect(Collectors.toMap(RecordStoreRole::getGrokPattern, Function.identity()));
        if(storeRole != null)
            roleMap.remove(storeRole.getGrokPattern());
        for(RecordStoreRole role : roleMap.values())
        {
            path = role.getExample().replace(role.getRecordIndex(), recordIndex);
            if(GrokParser.match(role.grokPattern, path) != null)
            {
                File file = new File(path);
                if(file.exists() && file.isFile())
                {
                    logger.debug(String.format("find %s for index=%s, master=%b", path, recordIndex, indexSearch.isMaster));
                    return path;
                }
                else
                {
                    logger.warn(String.format("%s is match for %s, but not exist", path, role.getGrokPattern()));
                }
            }
            else
            {
                logger.debug(String.format("index=%s not match for %s", recordIndex, role.getGrokPattern()));
            }
        }
        logger.error(String.format("can not find record file for index=%s", recordIndex));
        indexSearch.storeRole = null;
        return null;
    }

    protected boolean isEnterpriseChosen(String enterpriseId) {
        switch (enterpriseCfg.getChoseMethod())
        {
            case ALL:
                return true;
            case INCLUDE:
                return new HashSet<String>(enterpriseCfg.getList()).contains(enterpriseId);
            case EXCLUdE:
                return !(new HashSet<String>(enterpriseCfg.getList()).contains(enterpriseId));
        }
        return false;
    }

    private List<StoredRecordFileVo> scanMntDir(RecordStoreRole storeRole, Date chosenDate) throws IOException
    {
        DateFormat dateFormatCfg = storeRole.getDateFormat();
        String example = storeRole.getExample();
        String grokPattern = storeRole.getGrokPattern();
        String mntDir = storeRole.getMntDir();
        Map<String, Object> resultMap = GrokParser.match(grokPattern, storeRole.getExample());
        List<String> saveDirs = new ArrayList<>();
        if(resultMap.containsKey("date"))
        {
            String dateStr = resultMap.get("date").toString();
            SimpleDateFormat sf = new SimpleDateFormat(dateFormatCfg.getDate());
            searchForChosenTimeDir(mntDir, example, dateStr, sf.format(chosenDate), saveDirs);
        }
        else if(resultMap.containsKey("yearAndMonth"))
        {
            List<String> yearAndMonthDirList = new ArrayList<>();
            String yearAndMonth = resultMap.get("yearAndMonth").toString();
            SimpleDateFormat sf = new SimpleDateFormat(dateFormatCfg.getYearAndMonth());
            searchForChosenTimeDir(mntDir, example, yearAndMonth, sf.format(chosenDate), yearAndMonthDirList);
            if(resultMap.containsKey("monthAndDay"))
            {
                String monthAndDay = resultMap.get("monthAndDay").toString();
                sf = new SimpleDateFormat(dateFormatCfg.getMonthAndDay());
                for(String searchDir : yearAndMonthDirList)
                {
                    searchForChosenTimeDir(searchDir, example, monthAndDay, sf.format(chosenDate), saveDirs);
                }
            }
            else
            {
                String dayStr = resultMap.get("dayStr").toString();
                sf = new SimpleDateFormat(dateFormatCfg.getDay());
                for(String searchDir : yearAndMonthDirList)
                {
                    searchForChosenTimeDir(searchDir, example, dayStr, sf.format(chosenDate), saveDirs);
                }
            }
        }
        else
        {
            List<String> yearList = new ArrayList<>();
            String year = resultMap.get("year").toString();
            SimpleDateFormat sf = new SimpleDateFormat(dateFormatCfg.getYear());
            searchForChosenTimeDir(mntDir, example, year, sf.format(chosenDate), yearList);
            if(resultMap.containsKey("monthAndDay"))
            {
                String monthAndDay = resultMap.get("monthAndDay").toString();
                sf = new SimpleDateFormat(dateFormatCfg.getMonthAndDay());
                for(String searchDir : yearList)
                {
                    searchForChosenTimeDir(searchDir, example, monthAndDay, sf.format(chosenDate), saveDirs);
                }
            }
            else
            {
                String month = resultMap.get("dayStr").toString();
                sf = new SimpleDateFormat(dateFormatCfg.getMonth());
                List<String> monthDirList = new ArrayList<>();
                for(String searchDir : yearList)
                {
                    searchForChosenTimeDir(searchDir, example, month, sf.format(chosenDate), monthDirList);
                }
                String dayStr = resultMap.get("dayStr").toString();
                sf = new SimpleDateFormat(dateFormatCfg.getDay());
                for(String searchDir : monthDirList)
                {
                    searchForChosenTimeDir(searchDir, example, dayStr, sf.format(chosenDate), saveDirs);
                }
            }
        }
        int dept = example.split("/").length;
        List<String> allFileList = new ArrayList<>();
        for(String saveDir : saveDirs)
        {
            scan(saveDir, dept, false, ".*", allFileList);
        }
        int indexLen = storeRole.getRecordIndex().split("/").length;
        boolean escape = example.matches("^/") ? true : false;
        List<StoredRecordFileVo> retList = new ArrayList<>();
        for(String filePath : allFileList)
        {
            Map<String, Object> parseResultMap = GrokParser.match(grokPattern, filePath);
            if(parseResultMap != null)
            {
                String enterpriseId = parseResultMap.get("entId").toString();
                if(!isEnterpriseChosen(enterpriseId))
                {
                    logger.debug(String.format("[%s] %s need not backup", enterpriseId, filePath));
                    continue;
                }
                if(this.isWin)
                    filePath = filePath.replaceAll("\\\\", "/");
                String[] arr = filePath.split("/");
                String index = "";
                for(int i = indexLen; i >=1; i--)
                {
                    index += "/" + arr[arr.length - i];
                }
                if(!escape)
                {
                    index = index.replaceAll("^/", "");
                }
                StoredRecordFileVo fileVo = new StoredRecordFileVo(enterpriseId, chosenDate, filePath, index, grokPattern);
                retList.add(fileVo);
            }
        }
        return retList;
    }

    private void searchForChosenTimeDir(String searchPath, String srcPath, String srcTime, String dstTime, List<String> resultList) throws IOException
    {
        int dept = srcPath.split(String.format("/%s/", srcTime))[0].split("/").length + 1;
        String regex = String.format("^%s$", dstTime);
        scan(searchPath, dept, true, regex, resultList);
    }

    protected EntRecordCheckResultSumVo checkEntRecord(EnterpriseVo enterpriseVo, Date checkTime, Date beginTime, Date endTime, List<RecordDetailVo> entRecordList) {

        List<RecordDetailVo> successList = new ArrayList<>();
        List<RecordDetailVo> notIndexList = new ArrayList<>();
        List<RecordDetailVo> notFileList = new ArrayList<>();
        List<RecordDetailVo> notBakIndexList = new ArrayList<>();
        List<RecordDetailVo> notBakFileList = new ArrayList<>();
        RecordStoreRole storeRole = null;
        RecordStoreRole bkStoreRole = null;
        EntRecordCheckResultSumVo resultVo = null;
        for(RecordDetailVo detailVo : entRecordList)
        {
            //检查录音索引
            if(StringUtils.isBlank(detailVo.getRecordIndex()))
            {
                notIndexList.add(detailVo);
                continue;
            }
            //检查录音文件
            RecordIndexSearch indexSearch = new RecordIndexSearch();
            indexSearch.storeRole = storeRole;
            indexSearch.recordIndex = detailVo.getRecordIndex();
            indexSearch.isMaster = true;
            String fileSavePath = searchRecordIndexAbsolutePath(indexSearch);
            if(StringUtils.isBlank(fileSavePath))
            {
                notFileList.add(detailVo);
                continue;
            }
            storeRole = indexSearch.storeRole;
            if(isCheckBak(enterpriseVo.getEnterpriseId()))
            {
                if(StringUtils.isBlank(detailVo.getBakRecordIndex()))
                {
                    notBakIndexList.add(detailVo);
                    continue;
                }
                RecordIndexSearch bakIndexSearch = new RecordIndexSearch();
                bakIndexSearch.recordIndex = detailVo.getBakRecordIndex();
                bakIndexSearch.storeRole = bkStoreRole;
                bakIndexSearch.isMaster = false;
                String bkFileSavePath = searchRecordIndexAbsolutePath(bakIndexSearch);
                if(StringUtils.isBlank(bkFileSavePath))
                {
                    notBakFileList.add(detailVo);
                    continue;
                }
                bkStoreRole = bakIndexSearch.storeRole;
            }
            successList.add(detailVo);
        }
        if(isCheckBak(enterpriseVo.getEnterpriseId()))
        {
            resultVo = new EntRecordCheckResultSumVo(enterpriseVo, checkTime, beginTime, endTime, successList,
                    notIndexList, notFileList, notBakIndexList, notBakFileList);
        }
        else
        {
            resultVo = new EntRecordCheckResultSumVo(enterpriseVo, checkTime, beginTime, endTime, successList,
                    notIndexList, notFileList);
        }
        return resultVo;
    }

    /**
     * 获取某个目录下指定深度的且文件名或是最后一级目录满足正则表达式的所有文件(目录)
     * @param pathName 被扫描的目录
     * @param dept 深度
     * @param isDir 目录还是文件
     * @param regex 用来匹配最后一级目录或是文件名的正则表达式
     * @param resultList 扫描结果
     */
    private void scan(String pathName, int dept, boolean isDir, String regex, List<String> resultList) throws IOException
    {
        File dirFile = new File(pathName);
        //判断该文件或目录是否存在，不存在时在控制台输出提醒
        if (!dirFile.exists()) {
            logger.error(String.format("%s not exist", pathName));
            return;
        }
        else if(!dirFile.isDirectory() && !dirFile.isFile())
            return;
        String[] arr = pathName.split("/");
        int currentDept = arr.length;
        if(currentDept > dept)
            return;
        else if(currentDept == dept)
        {
            if((dirFile.isFile() && !isDir) || (dirFile.isDirectory() && isDir))
            {
                if(Pattern.matches(regex, arr[currentDept - 1])) {
                    System.out.println(pathName);
                    resultList.add(pathName);
                }
            }
            return;
        }
        else if(dirFile.isDirectory())
        {
            String[] fileList = dirFile.list();
            for(int i = 0; i < fileList.length; i++)
            {
                scan(pathName + "/" + fileList[i], dept, isDir, regex, resultList);
            }
        }
    }

    protected List<FailBackupRecordFilePo> backupByCopyDirectory(List<StoredRecordFileVo> storedRecordFileList, String backupRootDirectory, boolean isVerify, Date recordDate) throws IOException, Exception
    {
        List<FailBackupRecordFilePo> failList = new ArrayList<>();
        Map<String, List<StoredRecordFileVo>> dirFileMap = storedRecordFileList.stream().collect(Collectors.groupingBy(StoredRecordFileVo::getStoreDir));
        final ExecutorService executor = Executors.newFixedThreadPool(threadPoolSize);
        List<FutureTask<List<FailBackupRecordFilePo>>> taskList = new ArrayList<>();
        for(String storeDir : dirFileMap.keySet())
        {
            FutureTask<List<FailBackupRecordFilePo>> task = new FutureTask<>(new Callable<List<FailBackupRecordFilePo>>() {
                @Override
                public List<FailBackupRecordFilePo> call() throws Exception {
                    List<StoredRecordFileVo> fileList =  dirFileMap.get(storeDir);
                    List<FailBackupRecordFilePo> failList;
                    try
                    {
                        failList = backupDirByCopy(storeDir, fileList, backupRootDirectory, isVerify, recordDate);
                    }
                    catch (Exception ex)
                    {
                        failList = new ArrayList<>();
                        logger.error(String.format("copy files from %s to %s%s exception", storeDir, storeDir, backupRootDirectory), ex);
                        for(StoredRecordFileVo fileVo : fileList)
                        {
                            FailBackupRecordFilePo failPo = new FailBackupRecordFilePo();
                            failPo.setFailReason(ex.getMessage());
                            failPo.setRecordDate(recordDate);
                            failPo.setBackupPath(fileVo.getFileSavePath());
                            failPo.setFileSavePath(fileVo.getFileBackupPath(backupRootPath));
                            failList.add(failPo);
                        }
                    }
                    return failList;
                }
            });
            taskList.add(task);
            executor.execute(task);
        }
        executor.shutdown();
        for(FutureTask<List<FailBackupRecordFilePo>> task : taskList)
        {
            failList.addAll(task.get());
        }
        return failList;
    }

    private List<FailBackupRecordFilePo> backupDirByCopy(String storeDir, List<StoredRecordFileVo> recordFileList, String backupRootDirectory, boolean isVerify, Date recordDate) throws IOException
    {
        List<FailBackupRecordFilePo> failList = new ArrayList<>();
        String backupDir = String.format("%s%s", backupRootDirectory, storeDir);
        if(this.isWin)
            backupDir = String.format("%s%s", backupRootDirectory, storeDir.replaceAll("^[A-Z]:", ""));
        logger.debug(String.format("begin to copy all file from %s to %s", storeDir, backupDir));
        File srcDir = new File(storeDir);
        File dstDir = new File(backupDir);
        if(!dstDir.exists())
            dstDir.mkdirs();
        FileUtils.copyDirectory(srcDir, dstDir);
        for(StoredRecordFileVo fileVo : recordFileList)
        {
            fileVo.setBackupMethod(BackupMethod.COPY);
            fileVo.setBackupSavePath(String.format("%s/%s", backupDir, fileVo.getFileName()));
            if(isVerify)
            {
                File dstFile = new File(fileVo.getBackupSavePath());
                if(!dstFile.exists())
                {
                    logger.error(String.format("backup file verify fail : %s not exist", fileVo.getBackupSavePath()));
                    fileVo.setVerifyResult(false);
                    fileVo.setVerifyComment(String.format("%s not exist", fileVo.getBackupSavePath()));
                    FailBackupRecordFilePo po = new FailBackupRecordFilePo();
                    po.setBackupPath(fileVo.getBackupSavePath());
                    po.setRecordDate(recordDate);
                    po.setFailReason(String.format("%s not exist", fileVo.getBackupSavePath()));
                    failList.add(po);
                }
                else if(!dstFile.isFile())
                {
                    logger.error(String.format("backup file verify fail : %s not file", fileVo.getBackupSavePath()));
                    fileVo.setVerifyResult(false);
                    fileVo.setVerifyComment(String.format("%s not file", fileVo.getBackupSavePath()));
                    FailBackupRecordFilePo po = new FailBackupRecordFilePo();
                    po.setBackupPath(fileVo.getBackupSavePath());
                    po.setRecordDate(recordDate);
                    po.setFailReason(String.format("%s not file", fileVo.getBackupSavePath()));
                    failList.add(po);
                }
                else
                {
                    String dstMd5 = DigestUtils.md5DigestAsHex(new FileInputStream(fileVo.getBackupSavePath()));
                    String srcMd5 = DigestUtils.md5DigestAsHex(new FileInputStream(fileVo.getFileSavePath()));
                    if(!dstMd5.equals(srcMd5))
                    {
                        logger.error(String.format("backup file verify fail : %s md5=%s but %s md5=%s ", fileVo.getFileSavePath(), srcMd5, fileVo.getBackupSavePath(), dstMd5));
                        fileVo.setVerifyResult(false);
                        fileVo.setVerifyComment(String.format("%s md5=%s but %s md5=%s ", fileVo.getFileSavePath(), srcMd5, fileVo.getBackupSavePath(), dstMd5));
                        FailBackupRecordFilePo po = new FailBackupRecordFilePo();
                        po.setBackupPath(fileVo.getBackupSavePath());
                        po.setRecordDate(recordDate);
                        po.setFailReason(String.format("%s md5=%s but %s md5=%s ", fileVo.getFileSavePath(), srcMd5, fileVo.getBackupSavePath(), dstMd5));
                        failList.add(po);
                    }
                    else
                    {
                        logger.debug(String.format("copy from %s to %s success", fileVo.getFileSavePath(), fileVo.getBackupSavePath()));
                        fileVo.setResult(true);
                        fileVo.setVerifyResult(true);
                        fileVo.setVerifyComment(String.format("backup file %s verify success", fileVo.getFileSavePath()));
                    }
                }
            }
            else
            {
                fileVo.setResult(true);
            }
        }
        return failList;
    }

    protected boolean isCheckBak(String enterpriseId)
    {
        if(!this.hasBak)
            return false;
        if(this.enterpriseCfg.getNotCheckBakList() == null || this.enterpriseCfg.getNotCheckBakList().size() == 0)
            return true;
        Set<String> entSet = new HashSet<>(this.enterpriseCfg.getNotCheckBakList());
        if(entSet.contains(enterpriseId))
            return false;
        return true;
    }

    protected boolean addNewPlatformCheckResult(PlatformRecordCheckResultSumVo platformRecordCheckResultSumVo)
    {
        PlatformRecordCheckResultPo platformRecordCheckResultPo = platformRecordCheckResultSumVo.getCheckResult();
        int platformCheckId = this.platformRecordCheckResultDao.insert(platformRecordCheckResultPo);
        for(EntRecordCheckResultSumVo entSumVo : platformRecordCheckResultSumVo.getEntRecordCheckResultList())
        {
            int entCheckId = this.entRecordCheckResultDao.insert(platformCheckId, entSumVo.getCheckResult());
            if(!entSumVo.isResult())
                continue;
            for(RecordDetailVo detailVo : entSumVo.getNotIndexList())
            {
                CheckFailRecordDetailPo po = new CheckFailRecordDetailPo(entSumVo.getEnterpriseName(), detailVo, RecordCheckResult.INDEX_NOT_EXIST);
                checkFailRecordDetailDao.insert(platformCheckId, entCheckId, po);
            }
            for(RecordDetailVo detailVo : entSumVo.getNotFileList())
            {
                CheckFailRecordDetailPo po = new CheckFailRecordDetailPo(entSumVo.getEnterpriseName(), detailVo, RecordCheckResult.FILE_NOT_EXIST);
                checkFailRecordDetailDao.insert(platformCheckId, entCheckId, po);
            }
            for(RecordDetailVo detailVo : entSumVo.getNotBakIndexList())
            {
                CheckFailRecordDetailPo po = new CheckFailRecordDetailPo(entSumVo.getEnterpriseName(), detailVo, RecordCheckResult.BAK_INDEX_NOT_EXIST);
                checkFailRecordDetailDao.insert(platformCheckId, entCheckId, po);
            }
            for(RecordDetailVo detailVo : entSumVo.getNotBakFileList())
            {
                CheckFailRecordDetailPo po = new CheckFailRecordDetailPo(entSumVo.getEnterpriseName(), detailVo, RecordCheckResult.BAK_FILE_NOT_EXIST);
                checkFailRecordDetailDao.insert(platformCheckId, entCheckId, po);
            }
        }
        return true;
    }

    protected PlatformRecordCheckResultSumVo checkPlatformRecord(Date beginTime, Date endTime) throws Exception
    {
        logger.error(String.format("checkPlatformRecord function must been implement for %s platform", this.platformType.name));
        throw new Exception(String.format("checkPlatformRecord function must been implement for %s platform", this.platformType.name));
    }

    protected void addPlatformRecordBackupResult(PlatformRecordBackupResultSumVo platformRecordBackupResultSumVo)
    {
        PlatformRecordBackupResultPo backupResultPo = platformRecordBackupResultSumVo.getBackupResult();
        int backupId = this.platformRecordBackupResultDao.insert(backupResultPo);
        if(platformRecordBackupResultSumVo.isResult())
        {
            for(FailBackupRecordFilePo filePo : platformRecordBackupResultSumVo.getFailList())
            {
                this.failBackupRecordFileDao.insert(backupId, filePo);
            }
            for(RecordDetailVo detailPo : platformRecordBackupResultSumVo.getNotBackupList())
            {
                MissBackupRecordDetailPo po = new MissBackupRecordDetailPo(detailPo);
                this.missBackupRecordDetailDao.insert(backupId, po);
            }
        }
    }

    protected void generateTestDate(PlatformRecordCheckResultSumVo sumVo)
    {
        for(EntRecordCheckResultSumVo entSumVo : sumVo.getEntRecordCheckResultList())
        {
            if(!entSumVo.isResult())
                continue;
            entSumVo.getSuccessList().addAll(entSumVo.getNotIndexList());
            entSumVo.getSuccessList().addAll(entSumVo.getNotFileList());
            entSumVo.getSuccessList().addAll(entSumVo.getNotBakIndexList());
            entSumVo.getSuccessList().addAll(entSumVo.getNotBakFileList());
            entSumVo.setComment(entSumVo.toString());
        }
    }

    protected void generateTestDate(PlatformRecordBackupResultSumVo sumVo)
    {
        RecordDetailVo detailVo = new RecordDetailVo();
        detailVo.setEnterpriseId("11111");
        detailVo.setRecordIndex("0000050111/202003/60750230/0301/SIP-400603_5860042292_20200317123441.wav");
        detailVo.setRecordType(RecordType.MIX);
        detailVo.setHasBak(true);
        detailVo.setAgentId("2345");
        detailVo.setBakRecordIndex("0000057733/Agent/20200313/SIP-400503_5860042291_20200317113441.wav");
        detailVo.setCallType(1);
        Calendar ca = Calendar.getInstance();
        detailVo.setSessionId("6666688888");
        detailVo.setEndTime(ca.getTime());
        ca.add(Calendar.MINUTE, 22);
        detailVo.setStartTime(ca.getTime());
        detailVo.setEndType(255);
        detailVo.setTalkDuration(123);
        sumVo.getNotBackupList().add(detailVo);
        FailBackupRecordFilePo filePo = new FailBackupRecordFilePo();
        filePo.setFileSavePath("d:/temp/1.txt");
        filePo.setBackupPath("d:/temp/backup/temp/1.txt");
        ca.add(Calendar.HOUR, 1);
        filePo.setRecordDate(ca.getTime());
        filePo.setFailReason("just a test");
        sumVo.getFailList().add(filePo);
        sumVo.setComment(sumVo.toString());
    }

    protected class RecordIndexSearch
    {
        public String recordIndex;

        public RecordStoreRole storeRole;

        public boolean isMaster;
    }
}
